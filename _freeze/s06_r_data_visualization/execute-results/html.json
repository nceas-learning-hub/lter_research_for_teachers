{
  "hash": "c7872a9f81e9546d3933925fae39c68d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Data Visualization\n---\n\n\n\n\n:::{.callout-tip}\n## Learning Objectives\n\n\n- Understand the fundamentals of how the `ggplot2` package works\n- Use `ggplot2`'s `theme` and other customization functions create publication-grade graphics\n- Introduce the `leaflet` and `DT` package to create interactive maps and tables respectively\n:::\n\n## Overview\n\n`ggplot2` is a popular package for visualizing data in R.\nFrom the [home page](http://ggplot2.tidyverse.org/):\n\n> `ggplot2` is a system for declaratively creating graphics, based on The Grammar of Graphics. You provide the data, tell `ggplot2` how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details.\n\n\nIt's been around for years and has pretty good documentation and tons of example code around the web (like on [StackOverflow](https://stackoverflow.com/questions/tagged/ggplot2)). The goal of this lesson is to explain the fundamentals of how `ggplot2` work, introduce useful functions for customizing your plots and inspire you to go and explore this awesome resource for visualizing your data.\n\n::: callout-note\n\n## `ggplot2` vs base graphics in R vs others\nThere are many different ways to plot your data in R. All of them work! However, `ggplot2` excels at making complicated plots easy and easy plots simple enough\n\nBase R graphics  (`plot()`, `hist()`, etc) can be helpful for simple, quick and dirty plots. `ggplot2` can be used for almost everything else.\n\n:::\n\nLet's dive into creating and customizing plots with `ggplot2`.\n\n::: callout-tip\n## Setup\n\n0. Make sure you’re in the right project (`training_{USERNAME}`) and use the `Git` workflow by `Pull`ing to check for any changes. Then, create a new Quarto document, delete the default text, and save this document.\n\n1. Load the packages we'll need:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(forcats) # makes working with factors easier\nlibrary(ggplot2)\nlibrary(leaflet) # interactive maps\nlibrary(DT) # interactive tables\nlibrary(scales) # scale functions for visualization\nlibrary(janitor) # expedite cleaning and exploring data\nlibrary(viridis) # colorblind friendly color palette\n```\n:::\n\n\n\n\n\n\n2. Load the data directly from the [EDI Data Repository: Sacramento-San Joaquin Delta Socioecological Monitoring ](https://portal.edirepository.org/nis/mapbrowse?packageid=edi.587.1). Navigate to the link above, scroll down and under *Resources*, click the \"Download\" button for the \"Socioecological monitoring data\", and save or move it into a folder called `data` in your repository (you might need to create the folder first).  It saves as a file called `Socioecological_monitoring_data.csv`\n\n```r\ndelta_visits_raw <- read_csv(\"data/Socioecological_monitoring_data.csv\")\n```\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n3. Learn about the data. For this session we are going to be working with data on **Socioecological Monitoring on the Sacramento-San Joaquin Delta**. Check out [the documentation](https://portal.edirepository.org/nis/mapbrowse?packageid=edi.587.1).\n\n4. Finally, let's explore the data we just read into our working environment. \n\n```r\n## Check out column names\n\ncolnames(delta_visits_raw)\n\n## Peak at each column and class\nglimpse(delta_visits_raw)\n\n## From when to when\nrange(delta_visits_raw$Date)\n\n## Which time of day?\nunique(delta_visits_raw$Time_of_Day)\n```\n\n:::\n\n\n\n## Getting the data ready\n\nIt is more frequent than not, that we need to do some wrangling before we can plot our data the way we want to. After reading and exploring our data, we'll put our data wrangling skills to practice to get our data in the desired format.\n\n\n::: callout-important\n## Side note on clean column names\n`janitor::clean_names()` is an awesome function to transform all column names into the same format. The default format for this function is `snake_case_format`. We highly recommend having clear well formatted column names. It makes your life easier down the line.\n\nHow it works?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndelta_visits <- delta_visits_raw %>% \n    janitor::clean_names()\n```\n:::\n\n\n\n\nAnd that's it! If we look to the column names of the object `delta_visits` we can see all the columns are in a lowercase, snake format.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(delta_visits)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"eco_restore_approximate_location\" \"reach\"                           \n [3] \"latitude\"                         \"longitude\"                       \n [5] \"date\"                             \"time_of_day\"                     \n [7] \"sm_boat\"                          \"med_boat\"                        \n [9] \"lrg_boat\"                         \"bank_angler\"                     \n[11] \"scientist\"                        \"cars\"                            \n[13] \"notes\"                           \n```\n\n\n:::\n:::\n\n\n\n\n:::\n\n\nWith the [tidy data principles](https://learning.nceas.ucsb.edu/2024-06-delta/session_06.html) in mind. Is this data tidy?\n\n1. Every column is a variable.\n2. Every row is an observation.\n3. Every cell is a single value.\n\n`ggplot2` for the most part likes data input to be in a long format (aka \"tidy\"). So let go ahead and make this data frame long instead of wide. Do you remember the name of the function we can use?\n\nLet's refresh our memory on how this function works by accessing the `help` page. Type `?pivot_long()` in the console to see the documentation for this function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvisits_long <- delta_visits %>% \n    pivot_longer(cols = c(sm_boat, med_boat, lrg_boat, bank_angler, scientist, cars),\n                 names_to = \"visitor_type\",\n                 values_to = \"quantity\") %>%\n    rename(restore_loc = eco_restore_approximate_location) %>% \n    select(-notes)\n\n## Checking the outcome\nhead(visits_long)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 8\n  restore_loc   reach     latitude longitude date       time_of_day visitor_type\n  <chr>         <chr>        <dbl>     <dbl> <date>     <chr>       <chr>       \n1 Decker Island Brannan …     38.1     -122. 2017-07-07 unknown     sm_boat     \n2 Decker Island Brannan …     38.1     -122. 2017-07-07 unknown     med_boat    \n3 Decker Island Brannan …     38.1     -122. 2017-07-07 unknown     lrg_boat    \n4 Decker Island Brannan …     38.1     -122. 2017-07-07 unknown     bank_angler \n5 Decker Island Brannan …     38.1     -122. 2017-07-07 unknown     scientist   \n6 Decker Island Brannan …     38.1     -122. 2017-07-07 unknown     cars        \n# ℹ 1 more variable: quantity <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n\n\n::: callout-exercise\n\n- Calculate the daily visits by `restore_loc`, `date`, and `visitor_type`.\n\n:::{.callout-answer}\n \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_visits_loc <- visits_long %>%\n    group_by(restore_loc, date, visitor_type) %>% \n    summarise(daily_visits = sum(quantity))\n    \nhead(daily_visits_loc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n# Groups:   restore_loc, date [1]\n  restore_loc   date       visitor_type daily_visits\n  <chr>         <date>     <chr>               <dbl>\n1 Decker Island 2017-07-07 bank_angler             4\n2 Decker Island 2017-07-07 cars                    0\n3 Decker Island 2017-07-07 lrg_boat                0\n4 Decker Island 2017-07-07 med_boat                6\n5 Decker Island 2017-07-07 scientist               0\n6 Decker Island 2017-07-07 sm_boat                 0\n```\n\n\n:::\n:::\n\n\n\n\nThe chunk above uses some of the dplyr functions that we've used in the past. We use `group_by()` to indicate that we want to calculate our results for the unique combinations of type of visit, restoration location proximity, and day.  We next use `summarise()` to calculate an daily visit value for each of these groups. Note we use the `%in%` operator to pipe in the result of one command as an argument to the next one.\n\n:::\n\n:::\n\n## Plotting with `ggplot2`\n\n### Essential components\nFirst, we’ll cover some `ggplot2` basics to create the foundation of our plot. Then, we’ll add on to make our great customized data visualization.\n\n::: {.callout-tip}\n\n### The basics\n\n1. Indicate we are using `ggplot()` (call the `ggplot2::ggplot()` function)\n2. What data do we want to plot? (`data = my_data`)\n3. What are the mapping aesthetics? What variables do we want to plot? (define using`aes()` function)\n4. Define the geometry of our plot. This specifies the type of plot we're making (use `geom_*()` to indicate the type of plot e.g: point, bar, etc.)\n\n**Note**\nTo add layers to our plot, for example, additional geometries/aesthetics and theme elements or any `ggplot` object we use `+`.\n\n:::\n\n\nNow, let's plot total daily visits by restoration location. We will show this by creating the same plot in 3 slightly different ways. Each of the options below have the 4 essential pieces of a `ggplot`.\n\n\n```r\n## Option 1 - data and mapping called in the ggplot() function\nggplot(data = daily_visits_loc,\n       aes(x = restore_loc, y = daily_visits)) +\n    geom_col()\n\n\n## Option 2 - data called in ggplot function; mapping called in geom\nggplot(data = daily_visits_loc) +\n    geom_col(aes(x = restore_loc, y = daily_visits))\n\n\n## Option 3 - data and mapping called in geom\nggplot() +\n    geom_col(data = daily_visits_loc,\n             aes(x = restore_loc, y = daily_visits))\n\n```\n\nThey all will create the same plot:\n\n(Apologies for the jumbled text on the x-axis, we will learn how to make this look better soon)\n\n```r\nggplot(data = daily_visits_loc,\n       aes(x = restore_loc, y = daily_visits)) +\n    geom_col()\n```\n\n\n### Looking at different `geoms_*`\n\nHaving the basic structure with the essential components in mind, we can easily change the type of graph by updating the `geom_*()`.\n\n\n::: callout-warning\n### `ggplot2` and the pipe operator\n\nJust like in `dplyr` and `tidyr`, we can also pipe a `data.frame` directly into the first argument of the `ggplot` function using the `%>%` operator.\n\nThis can certainly be convenient, but use it carefully! Combining too many data-tidying or subsetting operations with your `ggplot` call can make your code more difficult to debug and understand.\n:::\n\nWe will use the pipe operator to pass into `ggplot()` a filtered version of `daily_visits_loc`, and make a plot with different geometries.\n\n\n**Boxplot**\n_Note: These examples are to demonstrate case uses of wrangling function prior to plotting. They are not necessarily plotting best practices._\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_visits_loc %>%\n    separate(date, c(\"year\", \"month\", \"day\"), sep = \"-\") %>%\n    filter(daily_visits < 30,\n           visitor_type %in% c(\"sm_boat\", \"med_boat\", \"lrg_boat\")) %>%\n    ggplot(aes(x = visitor_type, y = daily_visits)) +\n    geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/boxplot_ex-1.png){width=672}\n:::\n:::\n\n\n\n\n\n**Violin plot**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_visits_loc %>%\n    separate(date, c(\"year\", \"month\", \"day\"), sep = \"-\") %>%\n    filter(daily_visits < 30,\n           visitor_type %in% c(\"sm_boat\", \"med_boat\", \"lrg_boat\")) %>%\n    ggplot(aes(x = visitor_type, y = daily_visits)) +\n    geom_violin()\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/violin_plot-1.png){width=672}\n:::\n:::\n\n\n\n\n\n**Line and point**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_visits_loc %>%\n    filter(restore_loc == \"Decker Island\",\n           visitor_type == \"med_boat\") %>%\n    ggplot(aes(x = date, y = daily_visits)) +\n    geom_line() +\n    geom_point()\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/line_poin_plot-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### Customizing our plot\n\nLet's go back to our base bar graph. What if we want our bars to be blue instead of gray? You might think we could run this:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(x = restore_loc, y = daily_visits,\n           fill = \"blue\")) +\n    geom_col()\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/fill_blue-1.png){width=672}\n:::\n:::\n\n\n\n\nWhy did that happen?\n\nNotice that we tried to set the fill color of the plot inside the mapping aesthetic call. What we have done, behind the scenes, is create a column filled with the word \"blue\" in our data frame, and then mapped it to the `fill` aesthetic, which then chose the default fill color, salmon. \n\nWhat we really wanted to do was just change the color of the bars. If we want do do that, we can call the color option in the `geom_col()` function, **outside** of the mapping aesthetics function call.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(x = restore_loc, y = daily_visits)) +\n    geom_col(fill = \"blue\")\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/fill_blue_geom-1.png){width=672}\n:::\n:::\n\n\n\n\nWhat if we did want to map the color of the bars to a variable, such as `visitor_type`. `ggplot()` is really powerful because we can easily get this plot to visualize more aspects of our data. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(x = restore_loc, y = daily_visits,\n           fill = visitor_type)) +\n    geom_col()\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n::: {.callout-tip}\n\n### Keep in mind\n\n- If you want to map a variable onto a graph aesthetic (e.g., point color should be based on a specific region), put it within `aes()`.\n\n- If you want to update your plot base with a constant  (e.g. “Make ALL the points BLUE”), you can add the information directly to the relevant `geom_` layer outside the `aes()` call.\n\n:::\n\n\n#### Setting `ggplot` themes\n\n\nWe have successfully plotted our data. But, this is clearly not a nice plot. Let's work on making this plot look a bit nicer. We are going to:\n\n- Add a title, subtitle and adjust labels using `labs()`\n- Flip the x and y axis to make it a sideways column plot and make the labels easier to read\n- Include a built in theme using `theme_bw()`\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(y = restore_loc, x = daily_visits, fill = visitor_type)) +\n    geom_col() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during July 2017 and March 2018\") +\n    theme_bw()\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/theme_bw_plot-1.png){width=672}\n:::\n:::\n\n\n\n\nYou can see that the `theme_bw()` function changed a lot of the aspects of our plot! The background is white, the grid is a different color, etc. There are lots of other built in themes like this that come with the `ggplot2` package that help quickly set the look of the plot. Use the RStudio auto-complete `theme_` `<TAB>` to view a list of theme functions.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Themes\"}\n## Useful baseline themes are\ntheme_minimal()\ntheme_light()\ntheme_classic()\n```\n:::\n\n\n\n\n\n\nThe built in theme functions (`theme_*()`) change the default settings for many elements that can also be changed individually using the`theme()` function. The `theme()` function is a way to further fine-tune the look of your plot. This function takes MANY arguments (just have a look at `?theme`). Luckily there are many great `ggplot` resources online so we don't have to remember all of these, just Google [\"ggplot cheat sheet\"](https://www.google.com/search?q=ggplot+cheat+sheet&rlz=1C5CHFA_enUS989US989&oq=ggplot+chea&aqs=chrome.0.0i433i512j69i57j0i512l2j0i22i30i395l2.1681j1j7&sourceid=chrome&ie=UTF-8) and find one you like.\n\nLet's look at an example of a `theme()` call, where we change the position of the legend from the right side to the bottom, and remove the ticks of our Locations axis.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(y = restore_loc, x = daily_visits, fill = visitor_type)) +\n    geom_col() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during study period\") +\n    theme_bw() +\n    theme(legend.position = \"bottom\",\n          axis.ticks.y = element_blank()) \n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\nNote that the `theme()` call needs to come after any built-in themes like `theme_bw()` are used. Otherwise, `theme_bw()` will likely override any theme elements that you changed using `theme()`.\n\n\nYou can also save the result of a series of `theme()` function calls to an object to use on multiple plots. This prevents needing to copy paste the same lines over and over again!\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_theme <- theme_bw(base_size = 16) +\n    theme(legend.position = \"bottom\",\n          axis.ticks.y = element_blank())\n```\n:::\n\n\n\n\nSo now our code will look like this:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(y = restore_loc, x = daily_visits, fill = visitor_type)) +\n    geom_col() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during study period\") +\n    my_theme\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n\n::: {.callout-exercise}\n\nWhat changes do you expect to see in your plot by adding the following line of code? Discuss with your neighbor and then try it out!\n\n`scale_x_continuous(breaks = seq(0,120, 20))`\n\n::: {.callout-answer}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(y = restore_loc, x = daily_visits, fill = visitor_type)) +\n    geom_col() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during study period\") +\n    scale_x_continuous(breaks = seq(0,120, 20)) +\n    my_theme\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\n\n\n\nFinally we are going to expand the bars all the way to the axis line. In other words, remove the gap between the bars and the vertical \"x-axis\" line.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_loc,\n       aes(y = restore_loc, x = daily_visits, fill = visitor_type)) +\n    geom_col() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during study period\") +\n    scale_x_continuous(breaks = seq(0,120, 20), expand = c(0,0)) +\n    my_theme\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n#### Reordering things\n\n`ggplot()` loves putting things in alphabetical order. But more frequently than not, that's not the order you actually want things to be plotted. One way to do this is to use the `fct_reorder()` function from the `forcats` package. `forcats` provides tools for working with categorical variables. In this case, we want to reorder our categorical variable of `restore_loc` based on the total number of visits.\n\nThe first thing we need to do is to add a column to our data with the _total number of visits_ by location. This will be our \"sorting\" variable.  Then we use `fct_reorder()` to reorder the `restore_loc` variable according to our sorting variable.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_visits_totals <- daily_visits_loc %>% \n    group_by(restore_loc) %>%\n    mutate(n = sum(daily_visits)) %>% \n    ungroup() %>%\n    mutate(restore_loc = fct_reorder(restore_loc, n))\n\nhead(daily_visits_totals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n  restore_loc   date       visitor_type daily_visits     n\n  <fct>         <date>     <chr>               <dbl> <dbl>\n1 Decker Island 2017-07-07 bank_angler             4    37\n2 Decker Island 2017-07-07 cars                    0    37\n3 Decker Island 2017-07-07 lrg_boat                0    37\n4 Decker Island 2017-07-07 med_boat                6    37\n5 Decker Island 2017-07-07 scientist               0    37\n6 Decker Island 2017-07-07 sm_boat                 0    37\n```\n\n\n:::\n\n```{.r .cell-code}\nlevels(daily_visits_totals$restore_loc) ### not alphabetical any more!\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Sherman Island\"           \"Wildlands\"               \n [3] \"SJ River\"                 \"Twitchell Island\"        \n [5] \"SW Suisun Marsh\"          \"Decker Island\"           \n [7] \"Honker Bay/Chipps Island\" \"North Delta\"             \n [9] \"Grizzly Bay\"              \"Prospect\"                \n```\n\n\n:::\n:::\n\n\n\n\nNext, we will run the code for our plot adding the `fct_reorder()` function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_totals,\n       aes(x = daily_visits, y = restore_loc,\n           fill = visitor_type)) +\n    geom_col() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during study period\") +\n    scale_x_continuous(breaks = seq(0,120, 20), expand = c(0,0)) +\n    my_theme\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\nWhat if you want to plot the other way around? In this case from least to greater? We add the `desc()` to the variable we are sorting by.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_visits_totals <- daily_visits_loc %>% \n    group_by(restore_loc) %>%\n    mutate(n = sum(daily_visits)) %>% \n    ungroup() %>%\n    mutate(restore_loc = fct_reorder(restore_loc, desc(n)))\n\nggplot(data = daily_visits_totals,\n       aes(x = daily_visits, y = restore_loc,\n           fill = visitor_type)) +\n    geom_col() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during study period\") +\n    scale_x_continuous(breaks = seq(0,120, 20), expand = c(0,0)) +\n    my_theme\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Colors\n\nThe last thing we will do to our plot is change the color. To do this we are going to use a function from the `viridis` package. This package provides different color palettes that are designed to improve graph readability for readers with common forms of color blindness and/or color vision deficiency. With `viridis`, there are multiple other color palette packages or color palettes out there that you can use to customize your graphs. We could spend a whole session talking about colors in R! For the purpose of this lesson we are just going to keep it brief and show one function of the `viridis` package that will make our plot colors look better.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = daily_visits_totals,\n       aes(x = daily_visits, y = restore_loc,\n           fill = visitor_type)) +\n    geom_col() +\n    scale_fill_viridis_d() +\n    labs(x = \"Number of Visits\",\n         y = \"Restoration Location\",\n         fill = \"Type of Visitor\",\n         title = \"Total Number of Visits to Delta Restoration Areas by visitor type\",\n         subtitle = \"Sum of all visits during study period\") +\n    scale_x_continuous(breaks = seq(0,120, 20), expand = c(0,0)) +\n    my_theme\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n\nThings to keep in mind when choosing a color palette are the number of variables you have and how many colors your palette has. And if you need a discrete or a continuous color palette. Find more information about colors in this [R color cheatsheet](https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf). \n\n\n#### Saving plots\n\nSaving plots using `ggplot` is easy! The `ggsave()` function will save either the last plot you created, or any plot that you have saved to an object. You can specify what output format you want, size, resolution, etc. See `?ggsave()` for documentation.\n\nFor example, if we want to save our current plot to an existing folder named \"figures\", we can do this:\n\n```r\nggsave(\"figures/visit_restore_site_delta.jpg\", width = 12, height = 6, units = \"in\")\n```\n\n\n\n#### Creating multiple plots\n\nAn easy way to plot another aspect of your data is using the function `facet_wrap()`. This function takes a mapping to a variable using the syntax `~{variable_name}`. The `~` (tilde) is a model operator which tells `facet_wrap()` to model each unique value within `variable_name` to a facet in the plot.\n\nThe default behavior of facet wrap is to put all facets on the same x and y scale. You can use the `scales` argument to specify whether to allow different scales between facet plots (e.g `scales = \"free_y\"` to free the y axis scale). You can also specify the number of columns using the `ncol = ` argument or number of rows using `nrow =`.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfacet_plot <- ggplot(data = daily_visits_totals,\n       aes(x = visitor_type, y = daily_visits,\n           fill = visitor_type)) +\n    geom_col() +\n    facet_wrap(~restore_loc,\n               scales = \"free_y\",\n               ncol = 5,\n               nrow = 2) +\n    scale_fill_viridis_d() +\n    labs(x = \"Type of visitor\",\n         y = \"Number of Visits\",\n         title = \"Total Number of Visits to Delta Restoration Areas\",\n         subtitle = \"Sum of all visits during study period\") +\n    theme_bw() +\n    theme(legend.position = \"bottom\",\n          axis.ticks.x = element_blank(),\n          axis.text.x = element_blank())\n\nfacet_plot\n```\n\n::: {.cell-output-display}\n![](s06_r_data_visualization_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\nWe can save this plot to our figures folder too. Note that this time we are specifically mentioning the object we want to save.\n\n```r\nggsave(\"figures/visit_restore_site_facet.jpg\", plot = facet_plot, width = 12, height = 8, units = \"in\")\n\n```\n\n\n<!--#### Smarter tick labels using `scales`\n\nFixing tick labels in `ggplot` can be super annoying. The y-axis labels in the plot above don't look great. We could manually fix them, but it would likely be tedious and error prone.\n\nThe `scales` package provides some nice helper functions to easily rescale and relabel your plots. Here, we use `scale_y_continuous()` from `ggplot2`, with the argument `labels`, which is assigned to the function name `comma`, from the `scales` package. This will format all of the labels on the y-axis of our plot with comma-formatted numbers.-->\n\n\n## Interactive visualization\n\n### Tables with `DT`\n\nNow that we know how to make great static visualizations, let's introduce two other packages that allow us to display our data in interactive ways. These packages really shine when used with GitHub Pages, so at the end of this lesson we will publish our figures to the website we created earlier.\n\nFirst let's show an interactive table of unique sampling locations using `DT`.\nWe will start by creating a `data.frame` containing unique sampling locations.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocations <- visits_long %>%\n    distinct(restore_loc, .keep_all = T) %>%\n    select(restore_loc, latitude, longitude)\n\nhead(locations)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  restore_loc     latitude longitude\n  <chr>              <dbl>     <dbl>\n1 Decker Island       38.1     -122.\n2 SW Suisun Marsh     38.2     -122.\n3 Grizzly Bay         38.1     -122.\n4 Prospect            38.2     -122.\n5 SJ River            38.1     -122.\n6 Wildlands           38.3     -122.\n```\n\n\n:::\n:::\n\n\n\n\nThe `dplyr::distinct()` function comes pretty handy when you want to filter unique values in a column. In this case we use the `.keep_all = T` argument to keep all the columns of our data frame so we can have the `latitude` and `longitude` of each of the locations. If we don't add this argument, we would end up with a data frame with only one column: `restore_loc` and 10 rows, one for each of the unique locations.\n\n\nNow we can display this table as an interactive table using `datatable()` from the `DT` package.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatatable(locations)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-457c7a06684a30a5f373\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-457c7a06684a30a5f373\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\"],[\"Decker Island\",\"SW Suisun Marsh\",\"Grizzly Bay\",\"Prospect\",\"SJ River\",\"Wildlands\",\"North Delta\",\"Honker Bay/Chipps Island\",\"Twitchell Island\",\"Sherman Island\"],[38.105872,38.192684,38.11572,38.213087,38.053097,38.316412,38.184603,38.109048,38.096002,38.034339],[-121.70638,-121.912312,-122.030558,-121.667419,-121.842422,-121.693077,-121.661433,-121.708086,-121.674498,-121.761946]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>restore_loc<\\/th>\\n      <th>latitude<\\/th>\\n      <th>longitude<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"restore_loc\",\"targets\":1},{\"name\":\"latitude\",\"targets\":2},{\"name\":\"longitude\",\"targets\":3}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n### Maps with `leaflet`\n\nThe `leaflet()` package allows you to make basic interactive maps using just a couple lines of code. Note that unlike `ggplot2`, the `leaflet` package uses pipe operators (`%>%`) and not the additive operator (`+`).\n\nThe `addTiles()` function without arguments will add base tiles to your map from [OpenStreetMap](https://www.openstreetmap.org/). `addMarkers()` will add a marker at each location specified by the latitude and longitude arguments. Note that the `~` symbol is used here to model the coordinates to the map (similar to `facet_wrap()` in `ggplot`).\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleaflet(locations) %>%\n    addTiles() %>%\n    addMarkers(\n        lng = ~ longitude,\n        lat = ~ latitude,\n        popup = ~ restore_loc\n    )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-827da2a820d3716f39f6\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-827da2a820d3716f39f6\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addMarkers\",\"args\":[[38.105872,38.192684,38.11572,38.213087,38.053097,38.316412,38.184603,38.109048,38.096002,38.034339],[-121.70638,-121.912312,-122.030558,-121.667419,-121.842422,-121.693077,-121.661433,-121.708086,-121.674498,-121.761946],null,null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},[\"Decker Island\",\"SW Suisun Marsh\",\"Grizzly Bay\",\"Prospect\",\"SJ River\",\"Wildlands\",\"North Delta\",\"Honker Bay/Chipps Island\",\"Twitchell Island\",\"Sherman Island\"],null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[38.034339,38.316412],\"lng\":[-122.030558,-121.661433]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n<br>\n\nYou can also use `leaflet` to import Web Map Service (WMS) tiles. For example, we can use any of the base maps provided by USGS in the [National Map](https://basemap.nationalmap.gov/) archive. For example, let's use the USGSTopo base map. In this example, we also demonstrate how to create a more simple circle marker, the look of which is explicitly set using a series of style-related arguments.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleaflet(locations) %>%\n    addWMSTiles(\n        \"https://basemap.nationalmap.gov/arcgis/services/USGSTopo/MapServer/WmsServer\",\n        layers = \"0\",\n        options = WMSTileOptions(format = \"image/png\", transparent = TRUE)) %>%\n    addCircleMarkers(\n        lng = ~ longitude,\n        lat = ~ latitude,\n        popup = ~ restore_loc,\n        radius = 5,\n        # set fill properties\n        fillColor = \"salmon\",\n        fillOpacity = 1,\n        # set stroke properties\n        stroke = T,\n        weight = 0.5,\n        color = \"white\",\n        opacity = 1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-2b8117d9b06cdffaf6e8\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-2b8117d9b06cdffaf6e8\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addWMSTiles\",\"args\":[\"https://basemap.nationalmap.gov/arcgis/services/USGSTopo/MapServer/WmsServer\",null,null,{\"styles\":\"\",\"format\":\"image/png\",\"transparent\":true,\"version\":\"1.1.1\",\"layers\":\"0\"}]},{\"method\":\"addCircleMarkers\",\"args\":[[38.105872,38.192684,38.11572,38.213087,38.053097,38.316412,38.184603,38.109048,38.096002,38.034339],[-121.70638,-121.912312,-122.030558,-121.667419,-121.842422,-121.693077,-121.661433,-121.708086,-121.674498,-121.761946],5,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"white\",\"weight\":0.5,\"opacity\":1,\"fill\":true,\"fillColor\":\"salmon\",\"fillOpacity\":1},null,null,[\"Decker Island\",\"SW Suisun Marsh\",\"Grizzly Bay\",\"Prospect\",\"SJ River\",\"Wildlands\",\"North Delta\",\"Honker Bay/Chipps Island\",\"Twitchell Island\",\"Sherman Island\"],null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[38.034339,38.316412],\"lng\":[-122.030558,-121.661433]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n<br>\n\nWe can also layer base maps. In this case the USGSImageryTopo base map with the USGSHydroCached base map. Note that the url where the map is retrieved is very similar for each USGS base map.\n \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleaflet(locations) %>%\n    addWMSTiles(\n        \"https://basemap.nationalmap.gov/arcgis/services/USGSImageryTopo/MapServer/WmsServer\",\n        layers = \"0\",\n        options = WMSTileOptions(format = \"image/png\", transparent = TRUE)) %>%\n    addWMSTiles(\n        \"https://basemap.nationalmap.gov/arcgis/services/USGSHydroCached/MapServer/WmsServer\",\n        layers = \"0\",\n        options = WMSTileOptions(format = \"image/png\", transparent = TRUE)) %>%\n    addCircleMarkers(\n        lng = ~ longitude,\n        lat = ~ latitude,\n        popup = ~ restore_loc,\n        radius = 5,\n        # set fill properties\n        fillColor = \"salmon\",\n        fillOpacity = 1,\n        # set stroke properties\n        stroke = T,\n        weight = 0.5,\n        color = \"white\",\n        opacity = 1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-8a07ca5067b4256a7f0c\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-8a07ca5067b4256a7f0c\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addWMSTiles\",\"args\":[\"https://basemap.nationalmap.gov/arcgis/services/USGSImageryTopo/MapServer/WmsServer\",null,null,{\"styles\":\"\",\"format\":\"image/png\",\"transparent\":true,\"version\":\"1.1.1\",\"layers\":\"0\"}]},{\"method\":\"addWMSTiles\",\"args\":[\"https://basemap.nationalmap.gov/arcgis/services/USGSHydroCached/MapServer/WmsServer\",null,null,{\"styles\":\"\",\"format\":\"image/png\",\"transparent\":true,\"version\":\"1.1.1\",\"layers\":\"0\"}]},{\"method\":\"addCircleMarkers\",\"args\":[[38.105872,38.192684,38.11572,38.213087,38.053097,38.316412,38.184603,38.109048,38.096002,38.034339],[-121.70638,-121.912312,-122.030558,-121.667419,-121.842422,-121.693077,-121.661433,-121.708086,-121.674498,-121.761946],5,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"white\",\"weight\":0.5,\"opacity\":1,\"fill\":true,\"fillColor\":\"salmon\",\"fillOpacity\":1},null,null,[\"Decker Island\",\"SW Suisun Marsh\",\"Grizzly Bay\",\"Prospect\",\"SJ River\",\"Wildlands\",\"North Delta\",\"Honker Bay/Chipps Island\",\"Twitchell Island\",\"Sherman Island\"],null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[38.034339,38.316412],\"lng\":[-122.030558,-121.661433]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n \n\n<br>\n\nLeaflet has a ton of functionality that can enable you to create some beautiful, functional maps with relative ease. [Here](https://pages.github.nceas.ucsb.edu/NCEAS/sasap-data/language_vis.html) is an example of some we created as part of the [State of Alaskan Salmon and People (SASAP) project](https://www.nceas.ucsb.edu/workinggroups/state-alaskan-salmon-and-people-sasap), created using the same tools we showed you here. This map hopefully gives you an idea of how powerful the combination of Quarto or RMarkdown and GitHub Pages can be. \n\n\n## Publish the Data Visualization lesson to your webpage\n\n::: callout-tip\n### Steps\n\n1. Save the `qmd` you have been working on for this lesson.\n2. \"Render\" the `qmd`. This is a good way to test if everything in your code is working.\n3. Go to your `index.qmd` and the link to the `html` file with this lesson's content.\n4. Save and render `index.qmd` to an `html`.\n5. Use the `Git` workflow: ```Stage > Commit > Pull > Push```\n\n:::\n\n## `ggplot2` Resources\n\n- [Why not to use two axes, and what to use instead: The case against dual axis charts](https://blog.datawrapper.de/dualaxis/) by Lisa Charlotte Rost.\n- [Customized Data Visualization in `ggplot2`](https://allisonhorst.github.io/eds221-day8-comp/data_viz.html#3_ggplot2_Basics_Review) by Allison Horst.\n- [A `ggplot2` tutorial for beautiful plotting in R](https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/#legends) by Cedric Scherer.\n\n",
    "supporting": [
      "s06_r_data_visualization_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<link href=\"site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/leaflet-binding-2.2.2/leaflet.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}